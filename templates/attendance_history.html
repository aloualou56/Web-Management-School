{% extends 'base.html' %}

{% block title %}Attendance History - Robotiki{% endblock %}

{% block header %}Attendance History{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 fw-bold text-primary"><i class="fas fa-filter me-2"></i>Filter Records</h6>
    </div>
    <div class="card-body">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Select Class</label>
                <select name="grade" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Select --</option>
                    {% for grade in grades %}
                        <option value="{{ grade.id }}" {% if grade.id|stringformat:"s" == selected_grade_id %}selected{% endif %}>{{ grade.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>
</div>

{% if history %}
<div class="card shadow-sm mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 fw-bold text-primary"><i class="fas fa-history me-2"></i>Records for {{ history.first.grade.name }}</h6>
    </div>
    <div class="card-body">
        <div class="accordion" id="attendanceAccordion">
            {% for record in history %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ record.id }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ record.id }}" aria-expanded="false" aria-controls="collapse{{ record.id }}">
                        <span>{{ record.attendance_date|date:"l, F j, Y" }}</span>
                    </button>
                </h2>
                <div id="collapse{{ record.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ record.id }}" data-bs-parent="#attendanceAccordion">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-success">Present Students</h6>
                                <ul class="list-group list-group-flush">
                                    {% for student_name in record.present_students %}
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> {{ student_name }}</li>
                                    {% empty %}
                                        <li class="list-group-item text-muted">None</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-danger">Absent Students</h6>
                                <ul class="list-group list-group-flush">
                                    {% for student_name in record.absent_students %}
                                        <li class="list-group-item"><i class="fas fa-times text-danger me-2"></i> {{ student_name }}</li>
                                    {% empty %}
                                        <li class="list-group-item text-muted">None</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% else %}
    {% if selected_grade_id %}
        <div class="alert alert-info border-start border-info border-4" role="alert">
            <i class="fas fa-info-circle me-2"></i>No history found for this class.
        </div>
    {% endif %}
{% endif %}

{% endblock %}
